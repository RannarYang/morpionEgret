var __reflect=this&&this.__reflect||function(e,t,a){e.__class__=t,a?a.push(t):a=[t],e.__types__=e.__types__?a.concat(e.__types__):a},__extends=this&&this.__extends||function(e,t){function a(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(a.prototype=t.prototype,new a)},ButtonView=function(e){function t(t){var a=e.call(this)||this;a._name="",a._activeTexture="",a._disableTexture="",a._name=t;var i=RES.getRes("buttonConfig_json");return a._activeTexture=i[t].activeTexture,a._disableTexture=i[t].disableTexture,a.init(),a}return __extends(t,e),t.prototype.disable=function(){this._view.texture=RES.getRes(this._disableTexture),this._view.touchEnabled=!1},t.prototype.enable=function(){this._view.texture=RES.getRes(this._activeTexture),this._view.touchEnabled=!0},t.prototype.init=function(){this.createView()},t.prototype.createView=function(){this._view=new egret.Bitmap,this._view.texture=RES.getRes(this._activeTexture),this._view.touchEnabled=!0,this.addChild(this._view)},t}(egret.Sprite);__reflect(ButtonView.prototype,"ButtonView");var MenuViewManageEvent=function(e){function t(t,a,i){return void 0===a&&(a=!1),void 0===i&&(i=!1),e.call(this,t,a,i)||this}return __extends(t,e),t}(egret.Event);MenuViewManageEvent.TAP_UNDO="tap_undo",MenuViewManageEvent.TAP_TIPS="tap_tips",MenuViewManageEvent.TAP_REPLAY="tap_replay",MenuViewManageEvent.TAP_LEVEL="tap_level",__reflect(MenuViewManageEvent.prototype,"MenuViewManageEvent");var UserMovePawnCommand=function(){function e(e,t,a,i){this._numX=e,this._numY=t,this._me=a,this._chessView=i}return e.prototype.execute=function(){var e=!1,t=this._numX,a=this._numY;this._chessView.addChess(t,a,!0),GameData.chessBoard[t][a]=1;for(var i=0;i<GameData.count;i++)GameData.wins[t][a][i]&&(GameData.myWin[i]++,GameData.computerWin[i]+=6,5==GameData.myWin[i]&&(e=!0));return e},e.prototype.undo=function(){var e=this._numX,t=this._numY;1===GameData.chessBoard[e][t]&&(this._chessView.removeChess(),GameData.chessBoard[e][t]=0);for(var a=0;a<GameData.count;a++)GameData.wins[e][t][a]&&(GameData.myWin[a]--,GameData.computerWin[a]-=6)},e}();__reflect(UserMovePawnCommand.prototype,"UserMovePawnCommand",["Command"]);var Chess=function(){function e(e,t){this.numX=0,this.numY=0,this.numX=e,this.numY=t}return e}();__reflect(Chess.prototype,"Chess");var GameData=function(){function e(){}return e.initData=function(){for(var t=0;t<e.row;t++){e.chessBoard[t]=[];for(var a=0;a<e.row;a++)e.chessBoard[t][a]=0}e.wins=new Array;for(var t=0;t<e.row;t++){e.wins[t]=new Array;for(var a=0;a<e.col;a++)e.wins[t][a]=new Array}for(var i=0,t=0;15>t;t++)for(var a=0;11>a;a++){for(var n=0;5>n;n++)e.wins[t][a+n][i]=!0;i++}for(var t=0;15>t;t++)for(var a=0;11>a;a++){for(var n=0;5>n;n++)e.wins[a+n][t][i]=!0;i++}for(var t=0;11>t;t++)for(var a=0;11>a;a++){for(var n=0;5>n;n++)e.wins[t+n][a+n][i]=!0;i++}for(var t=0;11>t;t++)for(var a=14;a>3;a--){for(var n=0;5>n;n++)e.wins[t+n][a-n][i]=!0;i++}for(var t=0;i>t;t++)e.myWin[t]=0,e.computerWin[t]=0;e.count=i,this.movePawnCommands=[],e.stageW=egret.MainContext.instance.stage.stageWidth,e.stageH=egret.MainContext.instance.stage.stageHeight},e.getNextStep=function(t){var a=[],i=[];t?(a=e.myWin,i=e.computerWin):(a=e.computerWin,i=e.myWin);for(var n=[],r=[],s=0,o=0,h=0,p=0;15>p;p++){n[p]=[],r[p]=[];for(var u=0;15>u;u++)n[p][u]=0,r[p][u]=0}for(var p=0;15>p;p++)for(var u=0;15>u;u++)if(0===e.chessBoard[p][u]){for(var d=0;d<e.count;d++)e.wins[p][u][d]&&(1===i[d]?n[p][u]+=200:2===i[d]?n[p][u]+=400:3===i[d]?n[p][u]+=2e3:4===i[d]&&(r[p][u]+=1e4),1===a[d]?r[p][u]+=220:2===a[d]?r[p][u]+=420:3===a[d]?r[p][u]+=2100:4===a[d]&&(r[p][u]+=2e4));n[p][u]>s?(s=n[p][u],o=p,h=u):n[p][u]===s&&r[p][u]>r[o][h]&&(o=p,h=u),r[p][u]>s?(s=r[p][u],o=p,h=u):r[p][u]===s&&n[p][u]>n[o][h]&&(o=p,h=u)}return{numX:o,numY:h}},e.movePawnCommandsPop=function(){var e=this.movePawnCommands.pop();return this.updateObserver(),e},e.movePawnCommandsPush=function(e){this.movePawnCommands.push(e),this.updateObserver()},e.movePawnCommandsLen=function(){return this.movePawnCommands.length},e.addPawnObserver=function(e){this._pawnObservers.push(e)},e.updateObserver=function(){for(var e=0;e<this._pawnObservers.length;e++)this._pawnObservers[e].update(this.movePawnCommands.length)},e}();GameData.AI="AI1",GameData.undoNum=0,GameData.tipsNum=0,GameData.chessBoard=[],GameData.myWin=[],GameData.computerWin=[],GameData.count=0,GameData.row=15,GameData.col=15,GameData.stageW=0,GameData.stageH=0,GameData._pawnObservers=[],__reflect(GameData.prototype,"GameData");var LevelGameDataParse=function(){function e(){}return e.parseLevelGameData=function(e){GameData.AI=e.AI,GameData.undoNum=-1===e.undoNum?Number.POSITIVE_INFINITY:e.undoNum,GameData.tipsNum=-1===e.tipsNum?Number.POSITIVE_INFINITY:e.tipsNum},e}();__reflect(LevelGameDataParse.prototype,"LevelGameDataParse");var ChessBoardViewEvent=function(e){function t(t,a,i){void 0===a&&(a=!1),void 0===i&&(i=!1);var n=e.call(this,t,a,i)||this;return n.numX=0,n.numY=0,n}return __extends(t,e),t}(egret.Event);ChessBoardViewEvent.MOVE_PAWN="move_pawn",__reflect(ChessBoardViewEvent.prototype,"ChessBoardViewEvent");var GameEndViewEvent=function(e){function t(t,a,i){return void 0===a&&(a=!1),void 0===i&&(i=!1),e.call(this,t,a,i)||this}return __extends(t,e),t}(egret.Event);GameEndViewEvent.TAP_SURE="tap_sure",__reflect(GameEndViewEvent.prototype,"GameEndViewEvent");var LevelViewManageEvent=function(e){function t(t,a,i){return void 0===a&&(a=!1),void 0===i&&(i=!1),e.call(this,t,a,i)||this}return __extends(t,e),t}(egret.Event);LevelViewManageEvent.TAP_PRIMARY="tap_primary",LevelViewManageEvent.TAP_MIDDLE="tap_middle",LevelViewManageEvent.TAP_ADVANCED="tap_advanced",__reflect(LevelViewManageEvent.prototype,"LevelViewManageEvent");var ComputerMovePawnCommand=function(){function e(e){this._chessView=e}return e.prototype.execute=function(){var e=!1,t=GameData.getNextStep("computer"),a=t.numX,i=t.numY;this._chessView.addChess(a,i,!1),this._numX=a,this._numY=i,GameData.chessBoard[a][i]=2;for(var n=0;n<GameData.count;n++)GameData.wins[a][i][n]&&(GameData.computerWin[n]++,GameData.myWin[n]+=6,5==GameData.computerWin[n]&&(e=!0));return e},e.prototype.undo=function(){var e=this._numX,t=this._numY;this._chessView.removeChess(),GameData.chessBoard[e][t]=0;for(var a=0;a<GameData.count;a++)GameData.wins[e][t][a]&&(GameData.computerWin[a]--,GameData.myWin[a]-=6)},e}();__reflect(ComputerMovePawnCommand.prototype,"ComputerMovePawnCommand",["Command"]);var GameLogic=function(){function e(e){this._me=!0,this._isOver=!1,this._gameStage=e,this.init()}return e.prototype.init=function(){GameData.initData();this._levelConfigData=RES.getRes("levelConfig_json");LevelGameDataParse.parseLevelGameData(this._levelConfigData.primary);var e=new egret.Sprite,t=new ChessBoardView(e);this._gameStage.addChild(e);var a=this._chessView=new ChessView;this._gameStage.addChild(a);var i=new egret.Sprite;this._gameStage.addChild(i),this._menuViewManage=new MenuViewManage(i),GameData.addPawnObserver(this._menuViewManage);var n=new egret.Sprite;this._gameStage.addChild(n),this._leveViewManage=new LevelViewManage(n),this._leveViewManage.hide();var r=new egret.Sprite;this._gameStage.addChild(r),this._gameEndView=new GameEndView(r),t.addEventListener(ChessBoardViewEvent.MOVE_PAWN,this.move_pawn,this),this._menuViewManage.addEventListener(MenuViewManageEvent.TAP_UNDO,this.tap_undo,this),this._menuViewManage.addEventListener(MenuViewManageEvent.TAP_TIPS,this.tap_tips,this),this._menuViewManage.addEventListener(MenuViewManageEvent.TAP_REPLAY,this.tap_replay,this),this._menuViewManage.addEventListener(MenuViewManageEvent.TAP_LEVEL,this.tap_level,this),this._leveViewManage.addEventListener(LevelViewManageEvent.TAP_PRIMARY,this.tap_primary,this),this._leveViewManage.addEventListener(LevelViewManageEvent.TAP_MIDDLE,this.tap_middle,this),this._leveViewManage.addEventListener(LevelViewManageEvent.TAP_ADVANCED,this.tap_advanced,this),this._gameEndView.addEventListener(GameEndViewEvent.TAP_SURE,this.tap_sure,this)},e.prototype.initData=function(){this._me=!0,this._isOver=!1},e.prototype.move_pawn=function(e){if(!this._isOver){var t=e.numX,a=e.numY;if(0===GameData.chessBoard[t][a]){var i=new UserMovePawnCommand(t,a,this._me,this._chessView);if(GameData.movePawnCommandsPush(i),this._isOver=i.execute(),this._isOver)this._gameEndView.show(!0);else{this._me=!this._me;var n=new ComputerMovePawnCommand(this._chessView);GameData.movePawnCommandsPush(n),this._isOver=n.execute(),this._isOver&&this._gameEndView.show(!1)}}}},e.prototype.tap_undo=function(e){for(var t=GameData.movePawnCommandsLen()%2===0?2:1,a=0;t>a;a++){var i=GameData.movePawnCommandsPop();i.undo()}this._me=!0,this._isOver=!1,this._menuViewManage.enableTips()},e.prototype.tap_tips=function(e){var t=GameData.getNextStep(!0),a=t.numX,i=t.numY;this._chessView.addTipChess(a,i)},e.prototype.tap_replay=function(){GameData.initData(),this.initData(),this._menuViewManage.initData(),this._chessView.init()},e.prototype.tap_level=function(){this._leveViewManage.show()},e.prototype.tap_primary=function(){LevelGameDataParse.parseLevelGameData(this._levelConfigData.primary),this.tap_replay()},e.prototype.tap_middle=function(){LevelGameDataParse.parseLevelGameData(this._levelConfigData.middle),this.tap_replay()},e.prototype.tap_advanced=function(){LevelGameDataParse.parseLevelGameData(this._levelConfigData.advanced),this.tap_replay()},e.prototype.tap_sure=function(){this._menuViewManage.disableTips()},e}();__reflect(GameLogic.prototype,"GameLogic");var Main=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t}return __extends(t,e),t.prototype.onAddToStage=function(e){RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},t.prototype.onConfigComplete=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("game")},t.prototype.onResourceLoadComplete=function(e){"game"==e.groupName&&(RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.createGameScene())},t.prototype.onItemLoadError=function(e){console.warn("Url:"+e.resItem.url+" has failed to load")},t.prototype.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load"),this.onResourceLoadComplete(e)},t.prototype.createGameScene=function(){var e=new egret.Sprite;this.addChild(e),this._gl=new GameLogic(e)},t}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var ChessBoardView=function(e){function t(t){var a=e.call(this)||this;return a._layer=t,a.init(),a}return __extends(t,e),t.prototype.init=function(){var e=new egret.Shape;e.graphics.beginFill(14181669,1),e.graphics.drawRect(0,0,GameData.stageW,GameData.stageH),e.graphics.endFill(),e.graphics.lineStyle(2,12566463,1);for(var t=0;15>t;t++)e.graphics.moveTo(20+40*t,50),e.graphics.lineTo(20+40*t,610),e.graphics.endFill(),e.graphics.moveTo(20,20+40*t+30),e.graphics.lineTo(580,20+40*t+30),e.graphics.endFill();this._layer.addChild(e),e.touchEnabled=!0,e.addEventListener(egret.TouchEvent.TOUCH_TAP,this.tap,this)},t.prototype.tap=function(e){var t=new ChessBoardViewEvent(ChessBoardViewEvent.MOVE_PAWN);t.numX=Math.floor(e.stageX/40),t.numY=Math.floor((e.stageY-30)/40),this.dispatchEvent(t)},t}(egret.EventDispatcher);__reflect(ChessBoardView.prototype,"ChessBoardView");var ChessView=function(e){function t(){var t=e.call(this)||this;return t.init(),t}return __extends(t,e),t.prototype.init=function(){this.removeChildren(),this._myShapes=[],this._tipShape=null},t.prototype.addChess=function(e,t,a){this.removeTipChess();var i=new egret.Shape,n=20+40*e,r=50+40*t;a?i.graphics.beginFill(0,1):i.graphics.beginFill(16777215,1),i.graphics.drawCircle(n,r,15),i.graphics.endFill(),this._myShapes.push(i),this.addChild(i)},t.prototype.removeChess=function(){this.removeTipChess();var e=this._myShapes.pop();this.removeChild(e)},t.prototype.addTipChess=function(e,t){if(!this._tipShape){var a=this._tipShape=new egret.Shape,i=20+40*e,n=50+40*t;a.graphics.beginFill(16711680,.5),a.graphics.drawCircle(i,n,10),a.graphics.endFill(),this.addChild(a)}},t.prototype.removeTipChess=function(){this._tipShape&&(this.removeChild(this._tipShape),this._tipShape=null)},t}(egret.Sprite);__reflect(ChessView.prototype,"ChessView");var GameEndView=function(e){function t(t){var a=e.call(this)||this;return a._layer=t,a.init(),a.hide(),a}return __extends(t,e),t.prototype.show=function(e){e?this._resultBitmap.texture=RES.getRes("youwin_png"):this._resultBitmap.texture=RES.getRes("gameover_png"),this._layer.visible=!0},t.prototype.hide=function(){this._layer.visible=!1},t.prototype.init=function(){var e=new egret.Shape;e.touchEnabled=!0,e.graphics.beginFill(0,.7),e.graphics.drawRect(0,0,GameData.stageW,GameData.stageH),e.graphics.endFill(),e.graphics.beginFill(16777215,1),e.graphics.drawRoundRect(50,200,500,300,50,50),this._layer.addChild(e);var t=this._resultBitmap=new egret.Bitmap;t.x=50,t.y=230,this._layer.addChild(this._resultBitmap),this.initSureBtn()},t.prototype.initSureBtn=function(){var e=new ButtonView("sure");e.x=240,e.y=410,this._layer.addChild(e),e.addEventListener(egret.TouchEvent.TOUCH_TAP,this.tap_sure,this)},t.prototype.tap_sure=function(){this.hide();var e=new GameEndViewEvent(GameEndViewEvent.TAP_SURE);this.dispatchEvent(e)},t}(egret.EventDispatcher);__reflect(GameEndView.prototype,"GameEndView");var LevelViewManage=function(e){function t(t){var a=e.call(this)||this;return a._buttonArr=[],a._layer=t,a.init(),a}return __extends(t,e),t.prototype.show=function(){this._layer.visible=!0},t.prototype.hide=function(){this._layer.visible=!1},t.prototype.init=function(){this.addLevelBackground(),this.initPrimaryBtn(),this.initMiddleBtn(),this.initAdvancedBtn(),this.addCloseBtn();for(var e=this._buttonArr.length,t=0;e>t;t++){var a=this._buttonArr[t];a.x=(GameData.stageW-120)/2,a.y=260+(40+a.height)*t}},t.prototype.addLevelBackground=function(){var e=new egret.Shape;e.touchEnabled=!0,e.graphics.beginFill(0,.7),e.graphics.drawRect(0,0,GameData.stageW,GameData.stageH),e.graphics.endFill(),e.graphics.beginFill(16777215,1),e.graphics.drawRoundRect(175,220,250,320,50,50),this._layer.addChild(e)},t.prototype.initPrimaryBtn=function(){var e=this._primaryBtn=new ButtonView("primary");this._layer.addChild(e),this._buttonArr.push(e),e.addEventListener(egret.TouchEvent.TOUCH_TAP,this.tap_primary,this)},t.prototype.initMiddleBtn=function(){var e=this._middleBtn=new ButtonView("middle");this._layer.addChild(e),this._buttonArr.push(e),e.addEventListener(egret.TouchEvent.TOUCH_TAP,this.tap_middle,this)},t.prototype.initAdvancedBtn=function(){var e=this._advancedBtn=new ButtonView("advanced");this._layer.addChild(e),this._buttonArr.push(e),e.addEventListener(egret.TouchEvent.TOUCH_TAP,this.tap_advanced,this)},t.prototype.addCloseBtn=function(){var e=new egret.Bitmap;e.texture=RES.getRes("close_png"),e.x=395,e.y=205,e.touchEnabled=!0,this._layer.addChild(e),e.addEventListener(egret.TouchEvent.TOUCH_TAP,this.tap_close,this)},t.prototype.tap_primary=function(){this.hide();var e=new MenuViewManageEvent(LevelViewManageEvent.TAP_PRIMARY);this.dispatchEvent(e)},t.prototype.tap_middle=function(){this.hide();var e=new MenuViewManageEvent(LevelViewManageEvent.TAP_MIDDLE);this.dispatchEvent(e)},t.prototype.tap_advanced=function(){this.hide();var e=new MenuViewManageEvent(LevelViewManageEvent.TAP_ADVANCED);this.dispatchEvent(e)},t.prototype.tap_close=function(){this.hide()},t}(egret.EventDispatcher);__reflect(LevelViewManage.prototype,"LevelViewManage");var MenuViewManage=function(e){function t(t){var a=e.call(this)||this;return a._buttonArr=[],a._layer=t,a.init(),a}return __extends(t,e),t.prototype.disableUndo=function(){this._undoProp.disable()},t.prototype.enableUndo=function(){this._undoProp.enable()},t.prototype.disableTips=function(){this._tipsProp.disable()},t.prototype.enableTips=function(){this._tipsProp.enable()},t.prototype.update=function(e){e>0?this.enableUndo():this.disableUndo()},t.prototype.init=function(){this.initUndoProp(),this.initTipsProp(),this.initReplayBtn(),this.initLevelBtn();for(var e=this._buttonArr.length,t=0;e>t;t++){var a=this._buttonArr[t];a.x=24+(24+a.width)*t,a.y=630}this.initData()},t.prototype.initData=function(){this._undoProp.num=GameData.undoNum,this._tipsProp.num=GameData.tipsNum},t.prototype.initUndoProp=function(){var e=this._undoProp=new PropView("undo");this._layer.addChild(e),this.disableUndo(),this._buttonArr.push(e),e.addEventListener(egret.TouchEvent.TOUCH_TAP,this.tap_undo,this)},t.prototype.initTipsProp=function(){var e=this._tipsProp=new PropView("tips");this._layer.addChild(e),this._buttonArr.push(e),e.addEventListener(egret.TouchEvent.TOUCH_TAP,this.tap_tips,this)},t.prototype.initReplayBtn=function(){var e=this._replayBtn=new ButtonView("replay");this._layer.addChild(e),this._buttonArr.push(e),e.addEventListener(egret.TouchEvent.TOUCH_TAP,this.tap_replay,this)},t.prototype.initLevelBtn=function(){var e=this._levelBtn=new ButtonView("level");this._layer.addChild(e),this._buttonArr.push(e),e.addEventListener(egret.TouchEvent.TOUCH_TAP,this.tap_level,this)},t.prototype.tap_undo=function(){-1!==this._undoProp.num&&this._undoProp.num--;var e=new MenuViewManageEvent(MenuViewManageEvent.TAP_UNDO);this.dispatchEvent(e)},t.prototype.tap_tips=function(){-1!==this._tipsProp.num&&this._tipsProp.num--;var e=new MenuViewManageEvent(MenuViewManageEvent.TAP_TIPS);this.dispatchEvent(e)},t.prototype.tap_replay=function(){var e=new MenuViewManageEvent(MenuViewManageEvent.TAP_REPLAY);this.dispatchEvent(e)},t.prototype.tap_level=function(){var e=new MenuViewManageEvent(MenuViewManageEvent.TAP_LEVEL);this.dispatchEvent(e)},t}(egret.EventDispatcher);__reflect(MenuViewManage.prototype,"MenuViewManage");var PropView=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),Object.defineProperty(t.prototype,"num",{get:function(){return this._num},set:function(e){this._num=e,e>0?this.setActiveState(e,!0):this.setActiveState(e,!1)},enumerable:!0,configurable:!0}),t.prototype.disable=function(){e.prototype.disable.call(this),this.setActiveState(this._num,!1)},t.prototype.enable=function(){this._num>0&&(e.prototype.enable.call(this),this.setActiveState(this._num,!0))},t.prototype.init=function(){this.createView(),this.createNumText()},t.prototype.createNumText=function(){this._numText=new egret.Bitmap,this._numText.x=90,this._numText.y=-20,this.addChild(this._numText)},t.prototype.setActiveState=function(e,t){this.touchEnabled=t,t?(this._view.texture=RES.getRes(this._activeTexture),this._numText.texture=RES.getRes("num"+e+"_png")):(this._view.texture=RES.getRes(this._disableTexture),this._numText.texture=RES.getRes("num"+e+"_disable_png"))},t}(ButtonView);__reflect(PropView.prototype,"PropView");